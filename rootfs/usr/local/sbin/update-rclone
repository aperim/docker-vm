#!/bin/bash

# Exponential backoff parameters
base=2
attempt=0
max_attempts=5

while (( attempt < max_attempts ))
do
  curl https://rclone.org/install.sh | sudo bash -s beta
  rc=$?
  # If update is not needed
  if [ $rc -eq 3 ]; then
    echo "No update is needed for rclone."
    exit 0
  # If update was successful
  elif [ $rc -eq 0 ]; then
    echo "rclone successfully updated."
    exit 0
  else
    let "attempt++"
    echo "Update failed. Attempt $attempt/$max_attempts failed."
    let "delay=base**attempt"
    echo "Retrying after $delay seconds..."
    sleep $delay
  fi
done

# If we reach here, all attempts to update failed
echo "rclone update failed."
exit 1
